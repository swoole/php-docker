#!/usr/bin/env php
<?php

function render($tag, $type)
{
    $v = strstr($tag, '-', true) ?: $tag;
    if (version_compare($v, '8.0', '>=') or $v == 'rc' or $v == 'latest' or $v == 'alpine') {
        $CFLAGS = 'CFLAGS="$CFLAGS -D_GNU_SOURCE"';
    } else {
        $CFLAGS = '';
    }

    ob_start();
    include __DIR__ . '/templates/' . $type . '.php';
    $content = ob_get_clean();
    $dockerFile = __DIR__ . '/' . $tag . '/Dockerfile';

    if (!is_dir(dirname($dockerFile))) {
        mkdir(dirname($dockerFile));
    }
    file_put_contents($dockerFile, $content);
}

$debian_tags = ['7.2', '7.3', '7.4', '8.0', '8.1', '8.2', 'rc', 'latest'];
foreach ($debian_tags as $tag) {
    render($tag, 'debian');
}

$alpine_tags = ['7.2-alpine', '7.3-alpine', '7.4-alpine', '8.0-alpine', '8.1-alpine', '8.2-alpine', 'rc-alpine', 'alpine'];
foreach ($alpine_tags as $tag) {
    render($tag, 'alpine');
}
